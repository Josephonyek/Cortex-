<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cortex Master | Admin</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const firebaseConfig = {
            apiKey: "AIzaSyAzXdmATMQ8bMAtCIMiruUr4o5lGLMTSco",
            authDomain: "cortex-gold-6c147.firebaseapp.com",
            databaseURL: "https://cortex-gold-6c147-default-rtdb.firebaseio.com",
            projectId: "cortex-gold-6c147",
            storageBucket: "cortex-gold-6c147.firebasestorage.app",
            messagingSenderId: "744887943177",
            appId: "1:744887943177:web:c0f4aa606e6e204c7d38d8"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function Admin() {
            const [isLocked, setIsLocked] = useState(true);
            const [pass, setPass] = useState('');
            const [users, setUsers] = useState([]);
            const [products, setProducts] = useState([]);
            const [newP, setNewP] = useState({ name: '', price: '', icon: 'ðŸ“¦' });

            const SECRET = "Cortex2026";

            useEffect(() => {
                if (!isLocked) {
                    db.ref('users').on('value', s => setUsers(s.val() ? Object.values(s.val()) : []));
                    db.ref('products').on('value', s => setProducts(s.val() ? Object.entries(s.val()) : []));
                }
            }, [isLocked]);

            // --- USER BALANCE LOGIC ---
            const updateBalance = (uid, current, type) => {
                const val = prompt(type === 'set' ? "Set EXACT total balance:" : "Amount to ADD:");
                if (!val || isNaN(val)) return;
                
                const final = type === 'set' ? Number(val) : Number(current) + Number(val);
                db.ref(`users/${uid}/balance`).set(final);
            };

            // --- PRODUCT LOGIC ---
            const addProduct = (e) => {
                e.preventDefault();
                db.ref(`products/${Date.now()}`).set({...newP, price: Number(newP.price)});
                setNewP({ name: '', price: '', icon: 'ðŸ“¦' });
            };

            if (isLocked) return (
                <div className="h-screen flex items-center justify-center bg-blue-600">
                    <form onSubmit={(e) => {e.preventDefault(); if(pass===SECRET) setIsLocked(false); else alert("Invalid") }} className="bg-white p-8 rounded-3xl shadow-xl">
                        <input type="password" placeholder="Passcode" className="p-4 border rounded-xl mb-4 w-full" onChange={e=>setPass(e.target.value)} />
                        <button className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Unlock</button>
                    </form>
                </div>
            );

            return (
                <div className="p-4 md:p-10 max-w-6xl mx-auto">
                    <h1 className="text-3xl font-black text-blue-600 mb-10">CORTEX CONTROL</h1>

                    <div className="grid lg:grid-cols-2 gap-10">
                        {/* 1. PRODUCT UPLOADER */}
                        <section className="bg-white p-6 rounded-3xl border shadow-sm">
                            <h2 className="font-bold mb-4">Upload Product</h2>
                            <form onSubmit={addProduct} className="space-y-3">
                                <input value={newP.icon} onChange={e=>setNewP({...newP, icon:e.target.value})} placeholder="Icon (ðŸŽ®)" className="w-full p-3 bg-gray-50 rounded-xl border" />
                                <input value={newP.name} onChange={e=>setNewP({...newP, name:e.target.value})} placeholder="Product Name" className="w-full p-3 bg-gray-50 rounded-xl border" required />
                                <input value={newP.price} onChange={e=>setNewP({...newP, price:e.target.value})} type="number" placeholder="Price (â‚¦)" className="w-full p-3 bg-gray-50 rounded-xl border" required />
                                <button className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">Add to Site</button>
                            </form>
                            <div className="mt-6 space-y-2">
                                {products.map(([id, p]) => (
                                    <div key={id} className="flex justify-between items-center p-3 bg-gray-50 rounded-xl">
                                        <span>{p.icon} {p.name} - â‚¦{p.price}</span>
                                        <button onClick={()=>db.ref(`products/${id}`).remove()} className="text-red-500 text-xs font-bold">DELETE</button>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* 2. USER MANAGEMENT */}
                        <section className="bg-white p-6 rounded-3xl border shadow-sm">
                            <h2 className="font-bold mb-4">User Wallets & Database</h2>
                            <div className="space-y-4">
                                {users.map((u, i) => (
                                    <div key={i} className="p-4 border rounded-2xl bg-gray-50">
                                        <div className="flex justify-between items-start mb-3">
                                            <div>
                                                <p className="font-bold text-blue-600">@{u.username}</p>
                                                <p className="text-[10px] text-gray-400 uppercase tracking-tighter">{u.email}</p>
                                                <p className="text-xs font-medium">{u.phone}</p>
                                            </div>
                                            <p className="text-xl font-black">â‚¦{u.balance?.toLocaleString()}</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => updateBalance(u.uid, u.balance, 'add')} className="flex-1 bg-green-500 text-white py-2 rounded-lg text-[10px] font-bold">+ ADD CASH</button>
                                            <button onClick={() => updateBalance(u.uid, u.balance, 'set')} className="flex-1 bg-gray-800 text-white py-2 rounded-lg text-[10px] font-bold">SET EXACT</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>
                    </div>
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<Admin />);
    </script>
</body>
</html>